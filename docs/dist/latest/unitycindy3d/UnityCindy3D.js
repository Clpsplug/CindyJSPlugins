(function(){
'use strict';CindyJS.registerPlugin(1,"UnityCindy3D",function(b){var a=b.nada,d=b.evaluate;b=b.defineFunction;var k=[],e=-1,f=0,g=function(){if("undefined"==typeof uc3dBuffer)return!1;f=0;return!0},l=function(c){uc3dBuffer[f++]=c},m=function(c,h,a){uc3dBuffer[f++]=a;for(var b=h;b<h+a;++b)for(var p=coerce.toHomog(d(c[b])),e=0;3>e;e++)uc3dBuffer[f++]=p[e]},u=function(c){var h=c.length;uc3dBuffer[f++]=h;for(var a=0;a<h;++a)for(var b=coerce.toHomog(c[a]),d=0;3>d;d++)uc3dBuffer[f++]=b[d]},q=function(c,
a,b){var h=null,p=a,e=null;a={color:function(c){return h=coerce.toColor(c)},alpha:function(c){return coerce.toInterval(0,1,c)},shininess:function(c){return coerce.toInterval(0,128,c)},size:function(c){return p=coerce.toReal(c)},topology:function(c){return e=coerce.toString(c,e).toLowerCase()}};for(var g in c){var k=a[g];null!=k&&k(d(c[g]))}null!=h&&(uc3dBuffer[f++]=1,uc3dBuffer[f++]=h[0],uc3dBuffer[f++]=h[1],uc3dBuffer[f++]=h[2]);if(null!=b)for(uc3dBuffer[f++]=2,uc3dBuffer[f++]=b.length,c=0;c<b.length;++c)g=
coerce.toColor(b[c]),uc3dBuffer[f++]=g[0],uc3dBuffer[f++]=g[1],uc3dBuffer[f++]=g[2];null!=p&&(uc3dBuffer[f++]=0,uc3dBuffer[f++]=p);null!=e&&(uc3dBuffer[f++]=3,"close"==e?uc3dBuffer[f++]=1:uc3dBuffer[f++]=0);uc3dBuffer[f]=-1};b("clear3d",0,function(c,h){if(0==g())return a;gameInstance.SendMessage("Manager","Clear3D","");k=[];e=-1;f=0;return a});b("begin3d",0,function(c,a){return t("Default",a,!0)});b("begin3d",1,function(c,a){return t(coerce.toString(d(c[0])),a,!0)});b("createprototype3d",1,function(c,
a){return t(coerce.toString(d(c[0])),a,!1)});var t=function(c,h,b){if(-1!=e||0==g())return a;uc3dBuffer[f++]=b;gameInstance.SendMessage("Manager","Begin3D",c);e=Math.floor(uc3dBuffer[0]);k[e]={id:e,name:{ctype:"string",value:c},active:b,init:!1,start:null,update:null,collisionenter:null};return{ctype:"number",value:{real:e,imag:0}}};b("instantiate3d",2,function(c,a){return{ctype:"number",value:{real:v(c,a,!0),imag:0}}});b("extends3d",1,function(c,a){var h=-1;-1==e&&(e=h=v(c,a,!1));return{ctype:"number",
value:{real:h,imag:0}}});var v=function(c,a,b){a=-1;if(0==g())return a;var h=coerce.toInt(d(c[0])),e=k[h];e&&(l(h),(uc3dBuffer[f++]=b)&&m(c,1,1),gameInstance.SendMessage("Manager","Instantiate3D",""),a=Math.floor(uc3dBuffer[0]),k[a]={id:a,name:e.name,active:b,init:!1,start:e.start,update:e.update,collisionenter:e.collisionenter});return a};b("end3d",0,function(c,h){if(-1==e||0==g())return a;gameInstance.SendMessage("Manager","End3D","");e=-1;return a});b("oncollisionenter3d",2,function(c,h){h=coerce.toInt(d(c[0]));
c=coerce.toInt(d(c[1]));var b=k[h];if(!b)return a;console.log("oncollisionenter3d: id1 = "+h+" / id2 = "+c);null!=b.collisionenter&&(e=b.id,cdy.evokeCS(b.collisionenter+"("+c+");"));e=-1;return a});b("destroy3d",1,function(c,a){return w(e,c,0,a)});b("destroy3d",2,function(c,a){return w(coerce.toInt(d(c[0])),c,1,a)});var w=function(c,b,e,k){if(-1==c||0==g())return a;b=coerce.toReal(d(b[e]));l(c);uc3dBuffer[f++]=b;gameInstance.SendMessage("Manager","Destroy3D","");return a};b("ondestroy3d",1,function(c,
b){c=coerce.toInt(d(c[0]));delete k[c];console.log("ondestroy3d: id = "+c+" / gameobjs.length = "+Object.keys(k).length);return a});b("draw3d",1,function(c,b){if(-1==e||0==g())return a;m(c,0,1);q(b,null,null);gameInstance.SendMessage("Manager","AddPoint3D","");return a});b("draw3d",2,function(c,b){if(-1==e||0==g())return a;m(c,0,2);q(b,null,null);gameInstance.SendMessage("Manager","AddLine3D","");return a});b("connect3d",1,function(c,a){return x(c,a)});b("connect3d",2,function(c,a){return x(c,a)});
var x=function(c,b){if(-1==e||0==g())return a;u(coerce.toList(d(c[0])));var h=null;2==c.length&&(h=coerce.toList(d(c[1])));q(b,null,h);gameInstance.SendMessage("Manager","AddLine3D","");return a};b("fillpoly3d",1,function(c,b){if(-1==e||0==g())return a;u(coerce.toList(d(c[0])));q(b,null,null);gameInstance.SendMessage("Manager","AddPolygon3D","");return a});b("drawsphere3d",2,function(c,b){if(-1==e||0==g())return a;m(c,0,1);c=coerce.toReal(d(c[1]));q(b,c,null);gameInstance.SendMessage("Manager","AddSphere3D",
"");return a});b("setactive3d",1,function(c,a){return y(e,c,0,a)});b("setactive3d",2,function(c,a){return y(coerce.toInt(d(c[0])),c,1,a)});var y=function(c,b,e,r){if(-1==c||0==g())return a;r=k[c];if(!r)return a;b=coerce.toBool(d(b[e+1]));r.active=b;l(c);uc3dBuffer[f++]=b;gameInstance.SendMessage("Manager","SetActive3D","");return a};b("usegravity3d",1,function(c,a){return z(e,c,0,a)});b("usegravity3d",2,function(c,a){return z(coerce.toInt(d(c[0])),c,1,a)});var z=function(c,b,e,k){if(-1==c||0==g())return a;
b=coerce.toBool(d(b[e]));l(c);uc3dBuffer[f++]=b;gameInstance.SendMessage("Manager","UseGravity3D","");return a};b("addcollider3d",0,function(c,a){return A(e,c,a)});b("addcollider3d",1,function(a,b){return A(coerce.toInt(d(a[0])),a,b)});var A=function(c,b,d){if(-1==c||0==g())return a;l(c);gameInstance.SendMessage("Manager","AddCollider3D","");return a};b("get3d",1,function(a,b){return B(e,a,0,b)});b("get3d",2,function(a,b){return B(coerce.toInt(d(a[0])),a,1,b)});var B=function(c,b,e,f){if(-1==c||0==
g())return a;c=k[c];if(!c)return a;b=coerce.toString(d(b[e]));return c[b]?c[b]:a};b("setstart3d",1,function(a,b){return n(e,"start","();",a,0,b)});b("setstart3d",2,function(a,b){return n(coerce.toInt(d(a[0])),"start","();",a,1,b)});b("setupdate3d",1,function(a,b){return n(e,"update","();",a,0,b)});b("setupdate3d",2,function(a,b){return n(coerce.toInt(d(a[0])),"update","();",a,1,b)});b("setcollisionenter3d",1,function(a,b){return n(e,"collisionenter","",a,0,b)});b("setcollisionenter3d",2,function(a,
b){return n(coerce.toInt(d(a[0])),"collisionenter","",a,1,b)});var n=function(b,d,e,f,g,l){if(-1==b)return a;b=k[b];if(!b)return a;if("function"!==f[g].ctype)return console.log("argument is not a function"),a;b[d]=f[g].oper.replace(/\$.*/g,e);return a};b("update3d",0,function(b,d){if(null==cdy)return a;k.forEach(function(a){a.active&&(a.init||null==a.start||(e=a.id,cdy.evokeCS(a.start),a.init=!0),null!=a.update&&(e=a.id,cdy.evokeCS(a.update)))});e=-1;return a});b("setposition3d",1,function(a,b){return C(e,
a,0,b)});b("setposition3d",2,function(a,b){return C(coerce.toInt(d(a[0])),a,1,b)});var C=function(b,d,e,f){if(-1==b||0==g())return a;l(b);m(d,e,1);gameInstance.SendMessage("Manager","SetPosition3D","");return a};b("getposition3d",0,function(a,b){return D(e,a,0,b)});b("getposition3d",1,function(a,b){return D(coerce.toInt(d(a[0])),a,1,b)});var D=function(b,d,e,f){if(-1==b||0==g())return a;l(b);gameInstance.SendMessage("Manager","GetPosition3D","");return{ctype:"list",value:[{ctype:"number",value:{real:uc3dBuffer[0],
imag:0}},{ctype:"number",value:{real:uc3dBuffer[1],imag:0}},{ctype:"number",value:{real:uc3dBuffer[2],imag:0}}]}};b("setrotation3d",1,function(a,b){return E(e,a,0,b)});b("setrotation3d",2,function(a,b){return E(coerce.toInt(d(a[0])),a,1,b)});var E=function(b,d,e,f){if(-1==b||0==g())return a;l(b);m(d,e,1);gameInstance.SendMessage("Manager","SetRotation3D","");return a};b("setvelocity3d",1,function(a,b){return F(e,a,0,b)});b("setvelocity3d",2,function(a,b){return F(coerce.toInt(d(a[0])),a,1,b)});var F=
function(b,d,e,f){if(-1==b||0==g())return a;l(b);m(d,e,1);gameInstance.SendMessage("Manager","SetVelocity3D","");return a};b("getkey3d",1,function(b,e){e=!1;if(0==g())return a;gameInstance.SendMessage("Manager","GetKey3D",coerce.toString(d(b[0])));uc3dBuffer[0]&&(e=!0);return{ctype:"boolean",value:e}})});var coerce={toList:function(b,a){a=void 0===a?null:a;return"list"!==b.ctype?(console.log("argument is not a list"),a):b.value},toHomog:function(b,a,d){a=void 0===a?[0,0,0,0]:a;d=void 0===d?3:d;b=coerce.toList(b);if(null===b)return a;a=b.map(coerce.toReal);a.length>d+1&&(console.log("Coordinate vector too long."),a=a.slice(0,d+1));for(;a.length<d;)a.push(0);a.length===d&&a.push(1);return a},toDirection:function(b,a){a=void 0===a?[0,0,0]:a;b=coerce.toList(b);if(null===b)return a;a=b.map(coerce.toReal);
3<a.length&&(console.log("Coordinate vector too long."),a=a.slice(0,3));for(;3>a.length;)a.push(0);return a},toDirectionPoint:function(b,a){a=void 0===a?[0,0,0,0]:a;b=coerce.toDirection(b,a);b!==a&&(b[3]=0);return b},toColor:function(b,a){a=void 0===a?[.5,.5,.5]:a;if("number"===b.ctype){var d=coerce.toInterval(0,1,b);if(!isNaN(d))return[d,d,d]}b=coerce.toList(b);return null===b?a:3!=b.length?(console.log("Not an RGB color vector"),a):b.map(function(a){return coerce.toInterval(0,1,a)})},toReal:function(b,
a){a=void 0===a?Number.NaN:a;if("number"!==b.ctype)return console.log("argument is not a number"),a;b=b.value;a=b.real;0!==b.imag&&console.log("complex number is not real");return a},toInt:function(b,a){a=void 0===a?Number.NaN:a;if("number"!==b.ctype)return console.log("argument is not a number"),a;a=b.value;b=a.real;a=a.imag;0!==a&&console.log("complex number is not real");a=Math.round(b);a!==b&&console.log("number is not an integer");return a},clamp:function(b,a,d){return d<b?b:d>a?a:d},toInterval:function(b,
a,d,k){k=void 0===k?Number.NaN:k;return coerce.clamp(b,a,coerce.toReal(d,k))},toString:function(b,a){a=void 0===a?null:a;if("string"===b.ctype)return b.value;console.log("argument is not a string");return a},toEnum:function(b,a,d){d=void 0===d?null:d;a=coerce.toString(a,d);if(a!==d&&-1!==b.indexOf(a))return a;console.log("argument is not one of "+b.join(", "));return d},toBool:function(b,a){if("boolean"===b.ctype)return b.value;console.log("argument is not boolean");return a}};
}).call(this);

