(function(){
'use strict';CindyJS.registerPlugin(1,"UnityCindy3D",function(b){var a=b.nada,c=b.evaluate;b=b.defineFunction;var k=[],d=-1,g=0,h=function(){if("undefined"==typeof uc3dBuffer)return!1;g=0;return!0},l=function(e){uc3dBuffer[g++]=e},q=function(e){uc3dBuffer[g++]=e},m=function(e,a,b){uc3dBuffer[g++]=b;for(var f=a;f<a+b;++f)for(var n=coerce.toHomog(c(e[f])),d=0;3>d;d++)uc3dBuffer[g++]=n[d]},u=function(e){var a=e.length;uc3dBuffer[g++]=a;for(var b=0;b<a;++b)for(var c=coerce.toHomog(e[b]),d=0;3>d;d++)uc3dBuffer[g++]=
c[d]},p=function(e,a,b){var f=null,n=a,d=null;a={color:function(a){return f=coerce.toColor(a)},alpha:function(a){return coerce.toInterval(0,1,a)},shininess:function(a){return coerce.toInterval(0,128,a)},size:function(a){return n=coerce.toReal(a)},topology:function(a){return d=coerce.toString(a,d).toLowerCase()}};for(var h in e){var k=a[h];null!=k&&k(c(e[h]))}null!=f&&(uc3dBuffer[g++]=1,uc3dBuffer[g++]=f[0],uc3dBuffer[g++]=f[1],uc3dBuffer[g++]=f[2]);if(null!=b)for(uc3dBuffer[g++]=2,uc3dBuffer[g++]=
b.length,e=0;e<b.length;++e)h=coerce.toColor(b[e]),uc3dBuffer[g++]=h[0],uc3dBuffer[g++]=h[1],uc3dBuffer[g++]=h[2];null!=n&&(uc3dBuffer[g++]=0,uc3dBuffer[g++]=n);null!=d&&(uc3dBuffer[g++]=3,"close"==d?uc3dBuffer[g++]=1:uc3dBuffer[g++]=0);uc3dBuffer[g]=-1};b("clear3d",0,function(e,b){if(0==h())return a;gameInstance.SendMessage("Manager","Clear3D","");k=[];d=-1;g=0;return a});b("begin3d",0,function(a,b){return t("Default",b,!0)});b("begin3d",1,function(a,b){return t(coerce.toString(c(a[0])),b,!0)});
b("createprototype3d",1,function(a,b){return t(coerce.toString(c(a[0])),b,!1)});var t=function(e,b,c){if(-1!=d||0==h())return a;q(c);gameInstance.SendMessage("Manager","Begin3D",e);d=Math.floor(uc3dBuffer[0]);k.push({id:d,classname:e,active:c,init:!1,start:null,update:null});return{ctype:"number",value:{real:d,imag:0}}};b("instantiate3d",2,function(a,b){return{ctype:"number",value:{real:v(a,b,!0),imag:0}}});b("extends3d",1,function(a,b){var e=-1;-1==d&&(d=e=v(a,b,!1));return{ctype:"number",value:{real:e,
imag:0}}});var v=function(a,b,d){var e=-1;if(0==h())return e;var f=coerce.toInt(c(a[0]));k.forEach(function(b){b.id==f&&(l(f),q(d),d&&m(a,1,1),gameInstance.SendMessage("Manager","Instantiate3D",""),e=Math.floor(uc3dBuffer[0]),k.push({id:e,classname:b.classname,active:d,init:!1,start:b.start,update:b.update}))});return e};b("end3d",0,function(b,f){if(-1==d||0==h())return a;gameInstance.SendMessage("Manager","End3D","");d=-1;return a});b("draw3d",1,function(b,f){if(-1==d||0==h())return a;m(b,0,1);p(f,
null,null);gameInstance.SendMessage("Manager","AddPoint3D","");return a});b("draw3d",2,function(b,f){if(-1==d||0==h())return a;m(b,0,2);p(f,null,null);gameInstance.SendMessage("Manager","AddLine3D","");return a});b("connect3d",1,function(a,b){return w(a,b)});b("connect3d",2,function(a,b){return w(a,b)});var w=function(b,f){if(-1==d||0==h())return a;u(coerce.toList(c(b[0])));var e=null;2==b.length&&(e=coerce.toList(c(b[1])));p(f,null,e);gameInstance.SendMessage("Manager","AddLine3D","");return a};
b("fillpoly3d",1,function(b,f){if(-1==d||0==h())return a;u(coerce.toList(c(b[0])));p(f,null,null);gameInstance.SendMessage("Manager","AddPolygon3D","");return a});b("drawsphere3d",2,function(b,f){if(-1==d||0==h())return a;m(b,0,1);b=coerce.toReal(c(b[1]));p(f,b,null);gameInstance.SendMessage("Manager","AddSphere3D","");return a});b("setactive3d",1,function(a,b){return x(d,a,0,b)});b("setactive3d",2,function(a,b){return x(coerce.toInt(c(a[0])),a,1,b)});var x=function(b,f,d,g){if(-1==b||0==h())return a;
var e=null;k.forEach(function(a){a.id==b&&(e=a)});if(null==e)return a;f=coerce.toBool(c(f[d+1]));e.active=f;l(b);q(f,null);gameInstance.SendMessage("Manager","SetActive3D","");return a};b("usegravity3d",1,function(a,b){return y(d,a,0,b)});b("usegravity3d",2,function(a,b){return y(coerce.toInt(c(a[0])),a,1,b)});var y=function(b,f,d,g){if(-1==b||0==h())return a;l(b);q(coerce.toBool(c(f[d])),null);gameInstance.SendMessage("Manager","UseGravity3D","");return a};b("addcollider3d",0,function(a,b){return z(d,
a,b)});b("addcollider3d",1,function(a,b){return z(coerce.toInt(c(a[0])),a,b)});var z=function(b,f,c){if(-1==b||0==h())return a;l(b);gameInstance.SendMessage("Manager","AddCollider3D","");return a};b("setstart3d",1,function(a,b){return r(d,"start",a,0,b)});b("setstart3d",2,function(a,b){return r(coerce.toInt(c(a[0])),"start",a,1,b)});b("setupdate3d",1,function(a,b){return r(d,"update",a,0,b)});b("setupdate3d",2,function(a,b){return r(coerce.toInt(c(a[0])),"update",a,1,b)});var r=function(b,f,c,d,g){if(-1==
b)return a;var e=null;k.forEach(function(a){a.id==b&&(e=a)});if(null==e)return a;if("function"!==c[d].ctype)return console.log("argument is not a function"),a;e[f]=c[d].oper.replace("$0","();");return a};b("update3d",0,function(b,f){if(null==cdy)return a;k.forEach(function(a){a.active&&(a.init||null==a.start||(d=a.id,cdy.evokeCS(a.start),a.init=!0),null!=a.update&&(d=a.id,cdy.evokeCS(a.update)))});return a});b("setposition3d",1,function(a,b){return A(d,a,0,b)});b("setposition3d",2,function(a,b){return A(coerce.toInt(c(a[0])),
a,1,b)});var A=function(b,f,c,d){if(-1==b||0==h())return a;l(b);m(f,c,1);gameInstance.SendMessage("Manager","SetPosition3D","");return a};b("getposition3d",0,function(a,b){return B(d,a,0,b)});b("getposition3d",1,function(a,b){return B(coerce.toInt(c(a[0])),a,1,b)});var B=function(b,c,d,g){if(-1==b||0==h())return a;l(b);gameInstance.SendMessage("Manager","GetPosition3D","");return{ctype:"list",value:[{ctype:"number",value:{real:uc3dBuffer[0],imag:0}},{ctype:"number",value:{real:uc3dBuffer[1],imag:0}},
{ctype:"number",value:{real:uc3dBuffer[2],imag:0}}]}};b("setrotation3d",1,function(a,b){return C(d,a,0,b)});b("setrotation3d",2,function(a,b){return C(coerce.toInt(c(a[0])),a,1,b)});var C=function(b,c,d,g){if(-1==b||0==h())return a;l(b);m(c,d,1);gameInstance.SendMessage("Manager","SetRotation3D","");return a};b("setvelocity3d",1,function(a,b){return D(d,a,0,b)});b("setvelocity3d",2,function(a,b){return D(coerce.toInt(c(a[0])),a,1,b)});var D=function(b,c,d,g){if(-1==b||0==h())return a;l(b);m(c,d,1);
gameInstance.SendMessage("Manager","SetVelocity3D","");return a};b("getkey3d",1,function(b,d){d=!1;if(0==h())return a;gameInstance.SendMessage("Manager","GetKey3D",coerce.toString(c(b[0])));uc3dBuffer[0]&&(d=!0);return{ctype:"boolean",value:d}})});var coerce={toList:function(b,a){a=void 0===a?null:a;return"list"!==b.ctype?(console.log("argument is not a list"),a):b.value},toHomog:function(b,a,c){a=void 0===a?[0,0,0,0]:a;c=void 0===c?3:c;b=coerce.toList(b);if(null===b)return a;a=b.map(coerce.toReal);a.length>c+1&&(console.log("Coordinate vector too long."),a=a.slice(0,c+1));for(;a.length<c;)a.push(0);a.length===c&&a.push(1);return a},toDirection:function(b,a){a=void 0===a?[0,0,0]:a;b=coerce.toList(b);if(null===b)return a;a=b.map(coerce.toReal);
3<a.length&&(console.log("Coordinate vector too long."),a=a.slice(0,3));for(;3>a.length;)a.push(0);return a},toDirectionPoint:function(b,a){a=void 0===a?[0,0,0,0]:a;b=coerce.toDirection(b,a);b!==a&&(b[3]=0);return b},toColor:function(b,a){a=void 0===a?[.5,.5,.5]:a;if("number"===b.ctype){var c=coerce.toInterval(0,1,b);if(!isNaN(c))return[c,c,c]}b=coerce.toList(b);return null===b?a:3!=b.length?(console.log("Not an RGB color vector"),a):b.map(function(a){return coerce.toInterval(0,1,a)})},toReal:function(b,
a){a=void 0===a?Number.NaN:a;if("number"!==b.ctype)return console.log("argument is not a number"),a;b=b.value;a=b.real;0!==b.imag&&console.log("complex number is not real");return a},toInt:function(b,a){a=void 0===a?Number.NaN:a;if("number"!==b.ctype)return console.log("argument is not a number"),a;a=b.value;b=a.real;a=a.imag;0!==a&&console.log("complex number is not real");a=Math.round(b);a!==b&&console.log("number is not an integer");return a},clamp:function(b,a,c){return c<b?b:c>a?a:c},toInterval:function(b,
a,c,k){k=void 0===k?Number.NaN:k;return coerce.clamp(b,a,coerce.toReal(c,k))},toString:function(b,a){a=void 0===a?null:a;if("string"===b.ctype)return b.value;console.log("argument is not a string");return a},toEnum:function(b,a,c){c=void 0===c?null:c;a=coerce.toString(a,c);if(a!==c&&-1!==b.indexOf(a))return a;console.log("argument is not one of "+b.join(", "));return c},toBool:function(b,a){if("boolean"===b.ctype)return b.value;console.log("argument is not boolean");return a}};
}).call(this);

